{"version":3,"sources":["../src/scrollingWorldCamera.js"],"names":[],"mappings":"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","file":"scrollingWorldCamera.js","sourcesContent":["/*\nHexi supports game maps and levels created using the popular Tiled\nEditor level designer:\n\nwww.mapeditor.org\n   \nSee the simpler example `tileEditorSupport.html` for instructions on how to\nintegrate Tiled Editor maps into your Hexi code.\n\nBefore you read this source code, take a close look at the\n'maps/fantasy.tmx' in Tiled Editor to see how it was structured.\nObserve how Tiled Editor's layers were used to create depth layers.\nAlso notice that the heart, skull and marmot tileset images all have\ncustom `name` properties so that they're easy to access in the game\ncode.\n\nThis example is rather extreme. In a production level game you\nprobably shouldn't blit so many individual tile sprites to so many \ndepth levels, for performance reasons. It would be better to use a\nsingle, solid background image for the whole game world, \nand just use Tiled Editor's layers to generate arrays of obstacle and\nitem positions. But, if you need to create a shallow depth effect like\nyou now know how!\n*/\n\nlet thingsToLoad = [\n  \"images/fantasy.png\",\n  \"images/walkcycle.png\",\n  \"fonts/puzzler.otf\",\n  \"maps/fantasy.json\"\n];\n\n//Create a new Hexi instance, and start it.\nlet g = hexi(512, 512, setup, thingsToLoad);\n\n//Set the background color and scale the canvas\n//g.backgroundColor = \"black\";\ng.scaleToWindow();\n\n//Start Hexi\ng.start();\n\n//Game variables\nlet world, elf, elfTextures, camera, \n    itemsLayer, itemsMapArray, items, message,\n    leftArrow, upArrow, downArrow, rightArrow;\n\n//The `setup` function to initialize your application\nfunction setup() {\n\n  //Make the world from the Tiled JSON data and the tileset PNG image\n  world = g.makeTiledWorld(\n    \"maps/fantasy.json\", \n    \"images/fantasy.png\"\n  );\n\n  //Create the elf sprite using a filmstrip of animation frames\n  elf = g.sprite(g.filmstrip(\"images/walkcycle.png\", 64, 64));\n\n  /*\n  Tiled Editor lets you create generic objects. Take a look at the\n  `fantasy.tmx` file you'll see that the elf sprite was actually\n  created using of these generic objects. The object doesn't define\n  the elf's appearance, only its size and position. We're going to use\n  the object's data to position the elf sprite in the game world.\n  Position the elf sprite in the same place as the elf object\n  */\n\n  elf.x = world.getObject(\"elf\").x;\n  elf.y = world.getObject(\"elf\").y;\n\n  //Add the elf sprite the map's \"objects\" layer group\n  let objectsLayer = world.getObject(\"objects\");\n  objectsLayer.addChild(elf);\n\n  //If you want to, add the sprite to a different world layer,\n  //you can do it like this:\n  //world.getObject(\"treeTops\").addChild(elf);\n\n  //Use `world.getObjects` to get an array of objects on the map\n  //console.log(world.getObjects(\"marmot\", \"skull\", \"heart\"));\n\n  //Get all the items on the items layer (the skull, marmot and heart). \n  //The `itemLayer` group's `children` array contains all of them.\n  itemsLayer = world.getObject(\"items\");\n\n  //Clone the `itemLayer.children` array so that you have your own\n  //array of all three item sprites (the heart, skull and marmot)\n  items = itemsLayer.children.slice(0);\n  \n  /*\n  If you ever need to extract sprites with specific gid numbers in a \n  layer that contains different kinds of things, you can do it like this:\n\n  items = itemsLayer.children.map(function(sprite) {\n    if (sprite.gid !== 0) return sprite; \n  });\n\n  */\n  //Get a reference to the array containing the map items\n  itemsMapArray = world.getObject(\"items\").data;\n\n  /*\n  Create the camera and center it over the elf.\n  The `worldCamera` method returns a `camera` object\n  with `x` and `y` properties. It has\n  two useful methods: `centerOver`, to center the camera over\n  a sprite, and `follow` to make it follow a sprite.\n  `worldCamera` arguments: worldObject, worldWidth, worldHeight, theCanvas\n  The `world.woldWidth` and `world.worldHeight` values are the dimensions\n  of the Tiled map data's width and height.\n  */\n  \n  camera = g.worldCamera(world, world.worldWidth, world.worldHeight);\n  camera.centerOver(elf);\n  \n  //Define a `collisionArea` on the elf that will be sensitive to\n  //collisions. `hitTestTile` will use this information later to check\n  //whether the elf is colliding with any of the tiles\n\n  elf.collisionArea = {x: 22, y: 44, width: 20, height: 20};\n\n  /*\n  Define the elf's animation states. These are names that correspond\n  to frames and frame sequences in the elf's animation frames. It's\n  entirely up to you to decide what you want to call these states.\n  Define animation sequences as a 2-value array:\n\n      wallkleft: [startFrame, endFrame]\n\n  The first value is the frame number that the sequence should start\n  at, and the second value is the frame number that the sequence\n  should end at.\n  */\n\n  elf.states = {\n    up: 0,\n    left: 9,\n    down: 18,\n    right: 27,\n    walkUp: [1, 8],\n    walkLeft: [10, 17],\n    walkDown: [19, 26],\n    walkRight: [28, 35]\n  };\n\n  //Use the `show` method to display the elf's `right` state\n  elf.show(elf.states.right);\n  elf.fps = 18;\n \n  //Create some keyboard objects\n  leftArrow = g.keyboard(37);\n  upArrow = g.keyboard(38);\n  rightArrow = g.keyboard(39);\n  downArrow = g.keyboard(40);\n  \n  //Assign key `press` and release methods that\n  //show and play the elf's different states\n  leftArrow.press = () => {\n    elf.playAnimation(elf.states.walkLeft);\n    elf.vx = -2;\n    elf.vy = 0;\n  };\n  leftArrow.release = () => {\n    if (!rightArrow.isDown && elf.vy === 0) {\n      elf.vx = 0;\n      elf.show(elf.states.left);\n    }\n  };\n  upArrow.press = () => {\n    elf.playAnimation(elf.states.walkUp);\n    elf.vy = -2;\n    elf.vx = 0;\n  };\n  upArrow.release = () => {\n    if (!downArrow.isDown && elf.vx === 0) {\n      elf.vy = 0;\n      elf.show(elf.states.up);\n    }\n  };\n  rightArrow.press = () => {\n    elf.playAnimation(elf.states.walkRight);\n    elf.vx = 2;\n    elf.vy = 0;\n  };\n  rightArrow.release = () => {\n    if (!leftArrow.isDown && elf.vy === 0) {\n      elf.vx = 0;\n      elf.show(elf.states.right);\n    }\n  };\n  downArrow.press = () => {\n    elf.playAnimation(elf.states.walkDown);\n    elf.vy = 2;\n    elf.vx = 0;\n  };\n  downArrow.release = () => {\n    if (!upArrow.isDown && elf.vx === 0) {\n      elf.vy = 0;\n      elf.show(elf.states.down);\n    }\n  };\n\n  //Make a text object and set it to be invisible when the game\n  //first starts.\n  message = g.text(\"No items found\", \"12px puzzler\", \"black\");\n  message.setPosition(10, 10);\n  message.visible = false;\n\n  //Change the game state to `play`\n  g.state = play;  \n}\n\n//The `play` function contains all the game logic and runs in a loop\nfunction play() {\n\n  //Move the elf and constrain it to the world boundaries\n  //(-10 and -18 are to compensate for image padding around the sprite)\n  elf.x = Math.max(-18, Math.min(elf.x + elf.vx, world.worldWidth - elf.width + 18)); \n  elf.y = Math.max(-10, Math.min(elf.y + elf.vy, world.worldHeight - elf.height));\n\n  //Make the camera follow the elf\n  camera.follow(elf);\n\n  //Get a reference to the obstacles map array and use `hitTestTile`\n  //check for a collision between the elf and the ground tiles\n  //(See the example `tiledEditorSupport.html` for details on how to\n  //`hitTestTile` - it's not difficult)\n  let obstaclesMapArray = world.getObject(\"obstacles\").data;\n  let elfVsGround = g.hitTestTile(elf, obstaclesMapArray, 0, world, \"every\");\n\n  //If the elf isn't touching any ground tiles, it means its touching\n  //an obstacle, like a bush, the bottom of a wall, or the bottom of a\n  //tree\n  if (!elfVsGround.hit) {\n\n    //To prevent the elf from moving, subtract its velocity from its position\n    elf.x -= elf.vx;\n    elf.y -= elf.vy;\n    elf.vx = 0;\n    elf.vy = 0;\n    \n    //You can find the gid number of the thing the elf hit like this:\n    //console.log(obstaclesMapArray[elfVsGround.index]);\n  }\n\n  //Check for a collision with the items\n  let elfVsItems = g.hitTestTile(elf, itemsMapArray, 0, world, \"some\");\n\n  //You'll know whether the elf is touching an item if `elfVsItem.hit`\n  //isn't `0`. `0` indicates a empty cell in the array, so any tile\n  //doesn't have a grid index number (`gid`) of `0` must be one of the\n  //items (The heart, marmot or skull).\n  //If the elf is touching an item tile, filter through all the items\n  //in the `items` array and remove the item being touched.\n  if (!elfVsItems.hit) {\n    items = items.filter(item => {\n\n      //Does the current item match the elf's position?\n      if (item.index === elfVsItems.index) {\n\n        //Display the message\n        message.visible = true;\n        message.content = \"You found a \" + item.name;\n\n        //Make the message disappear after 3 seconds\n        g.wait(3000, function(){\n          message.visible = false;\n        });\n\n        //Remove the item\n        itemsMapArray[item.index] = 0;\n        g.remove(item);\n        return false;\n      } else {\n        return true;\n      }\n    }); \n  }\n}\n\n"]}